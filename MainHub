local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
   Name = "Wanz Hub [ARX]",
   LoadingTitle = "Loading Codes",
   LoadingSubtitle = "Wait...",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "WanzHubConfig",
      FileName = "ARXSettings"
   }
})

-- Create tabs
local MainTab = Window:CreateTab("MENU", 4483362458)
local ScriptsTab = Window:CreateTab("SCRIPTS", 4483362458)

-- ===== MAIN FUNCTIONALITY =====

-- UI Removal System (Original behavior)
spawn(function()
    while task.wait(1) do
        pcall(function()
            -- ALWAYS remove Summon_Amount (original behavior)
            local summon = game:GetService("Players").LocalPlayer:FindFirstChild("Summon_Amount")
            if summon then summon:Destroy() end
            
            -- Only remove GameEndedAnimationUI when there's no lobby
            if not workspace:FindFirstChild("Lobby") then
                local gui = game:GetService("Players").LocalPlayer.PlayerGui
                local animUI = gui:FindFirstChild("GameEndedAnimationUI")
                if animUI then 
                    animUI:Destroy() 
                end
            end
        end)
    end
end)

-- Player Stats UI Toggle
local StatsUIToggle = MainTab:CreateToggle({
   Name = "Player Stats UI",
   CurrentValue = false,
   Flag = "PlayerStatsToggle",
   Callback = function(Value)
      if Value then
         -- Create UI function here
      else
         local gui = game:GetService("Players").LocalPlayer.PlayerGui
         if gui:FindFirstChild("PlayerStatsGUI") then
            gui.PlayerStatsGUI:Destroy()
         end
      end
   end,
})

-- Enhanced Reward Detection with current amounts
local rewardCheckCooldown = false

local function getPlayerItemAmount(itemName)
    local player = game:GetService("Players").LocalPlayer
    local success, result = pcall(function()
        local playerData = game:GetService("ReplicatedStorage").Player_Data:FindFirstChild(player.Name) or player:FindFirstChild("Data")
        if playerData then
            local items = playerData:FindFirstChild("Items") or playerData:FindFirstChild("Inventory")
            if items then
                local item = items:FindFirstChild(itemName)
                return item and item:FindFirstChild("Amount") and item.Amount.Value or 0
            end
        end
        return 0
    end)
    return success and result or 0
end

local function showGameResults()
    if rewardCheckCooldown then return end
    rewardCheckCooldown = true
    
    pcall(function()
        task.wait(2) -- Wait for rewards to load
        
        local player = game:GetService("Players").LocalPlayer
        local rewardsFolder = player:FindFirstChild("RewardsShow")
        
        if rewardsFolder then
            local rewardText = {"Game Finished", "You got:"}
            local foundRewards = false
            
            for _, item in pairs(rewardsFolder:GetChildren()) do
                local rewardAmount = item:IsA("NumberValue") and item.Value or (item:FindFirstChild("Amount") and item.Amount.Value or 0)
                
                if rewardAmount > 0 then
                    local currentAmount = getPlayerItemAmount(item.Name)
                    table.insert(rewardText, string.format("[%dx] %s [Now: %dx]", rewardAmount, item.Name, currentAmount))
                    foundRewards = true
                end
            end
            
            if foundRewards then
                Rayfield:Notify({
                    Title = "Game Results",
                    Content = table.concat(rewardText, "\n"),
                    Duration = 6.5,
                    Image = 4483362458,
                })
            end
        end
    end)
    
    task.wait(5)
    rewardCheckCooldown = false
end

-- Game End Detection
spawn(function()
    while task.wait(0.5) do
        pcall(function()
            local playerGui = game:GetService("Players").LocalPlayer.PlayerGui
            if playerGui:FindFirstChild("GameEndedAnimationUI") then
                showGameResults()
                while playerGui:FindFirstChild("GameEndedAnimationUI") do
                    task.wait(1)
                end
            end
        end)
    end
end)

-- Voting System
local votingActive = { Next = false, Retry = false }

local NextVoteToggle = MainTab:CreateToggle({
   Name = "Vote Next",
   CurrentValue = false,
   Flag = "VoteNextToggle",
   Callback = function(Value)
      votingActive.Next = Value
      if Value then
         Rayfield:Notify({ Title = "Voted", Content = "You voted for Next Map", Duration = 3 })
         spawn(function()
             while votingActive.Next do
                 game:GetService("ReplicatedStorage").Remote.Server.OnGame.Voting.VoteNext:FireServer()
                 task.wait(1)
             end
         end)
      end
   end,
})

local RetryVoteToggle = MainTab:CreateToggle({
   Name = "Vote Retry",
   CurrentValue = false,
   Flag = "VoteRetryToggle",
   Callback = function(Value)
      votingActive.Retry = Value
      if Value then
         Rayfield:Notify({ Title = "Voted", Content = "You voted to Retry Map", Duration = 3 })
         spawn(function()
             while votingActive.Retry do
                 game:GetService("ReplicatedStorage").Remote.Server.OnGame.Voting.VoteRetry:FireServer()
                 task.wait(1)
             end
         end)
      end
   end,
})

-- Toggle Exclusivity
NextVoteToggle:OnChanged(function(Value)
   if Value then
      RetryVoteToggle:Set(false)
      votingActive.Retry = false
   end
end)

RetryVoteToggle:OnChanged(function(Value)
   if Value then
      NextVoteToggle:Set(false)
      votingActive.Next = false
   end
end)

-- ===== ADDITIONAL SCRIPTS TAB =====
ScriptsTab:CreateSection("Extra Features")

-- Example: Auto Farm Toggle
local AutoFarmToggle = ScriptsTab:CreateToggle({
   Name = "Auto Farm Coins",
   CurrentValue = false,
   Flag = "AutoFarmToggle",
   Callback = function(Value)
      if Value then
         Rayfield:Notify({Title = "Auto Farm", Content = "Enabled", Duration = 2})
      else
         Rayfield:Notify({Title = "Auto Farm", Content = "Disabled", Duration = 2})
      end
   end,
})

-- Example: Teleport Button
ScriptsTab:CreateButton({
   Name = "Teleport to Spawn",
   Callback = function()
      Rayfield:Notify({Title = "Teleporting", Content = "Going to spawn point", Duration = 2})
   end,
})

-- Load saved configurations (MUST BE LAST LINE)
Rayfield:LoadConfiguration()
